<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="utf-8" />
    <title>Book Catalog</title>

    <style>
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .cart-icon {
            position: relative;
            cursor: pointer;
        }
        .cart-count {
            position: absolute;
            top: -6px;
            right: -10px;
            background: red;
            color: white;
            border-radius: 50%;
            padding: 2px 6px;
            font-size: 12px;
        }
    </style>
</head>
<body>

<div class="top-bar">
    <div th:if="${#authentication != null and #authentication.authenticated}">
        Hello, <b th:text="${#authentication.name}"></b>
    </div>

    <!-- Cart Icon -->
    <a href="/cart" class="cart-icon">
        ðŸ§º
        <span id="cartCount" class="cart-count">0</span>
    </a>
</div>

<h2>Book Catalog</h2>

<form action="/books" method="get">
    <label>Category:</label>
    <select name="categoryId">
        <option value="">All Categories</option>
        <option th:each="cat : ${categories}"
                th:value="${cat.id}"
                th:text="${cat.name}"
                th:selected="${cat.id == selectedCategory}">
        </option>
    </select>

    <input name="q" th:value="${q}" placeholder="Title or author" />
    <button type="submit">Filter</button>
</form>

<hr />

<ul>
    <li th:each="book : ${books}">
        <h3 th:text="${book.title} + ' â€” ' + ${book.author}"></h3>

        <p>â‚±<span th:text="${#numbers.formatDecimal(book.price,1,'COMMA',2,'POINT')}"></span></p>

        <button class="add-to-cart-btn"
                th:attr="data-id=${book.id},
                         data-title=${book.title},
                         data-price=${book.price}">
            Add to Cart
        </button>
        <hr />
    </li>
</ul>

<script src="/js/cart.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", updateCartCount);
</script>
</body>
</html>
